<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard ‚Äì MediaBuzz365</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* (Keeping your existing styles ‚Äì shortened for clarity) */

*{box-sizing:border-box;margin:0;padding:0;}
body{
 font-family:Arial;
 background:linear-gradient(135deg,#667eea,#764ba2);
 min-height:100vh;
}

/* SIDEBAR */
.sidebar{
 position:fixed;
 left:0;top:0;
 width:260px;
 height:100vh;
 background:#020617;
 padding:25px;
 color:#fff;
}

/* MAIN */
.main{
 margin-left:260px;
 padding:30px;
}

/* CARD */
.card{
 background:#fff;
 padding:25px;
 border-radius:14px;
 margin-bottom:25px;
}

/* INPUTS */
input,textarea,select{
 width:100%;
 padding:12px;
 margin:10px 0;
 border-radius:10px;
 border:2px solid #e5e7eb;
}

.save-btn{
 padding:12px 24px;
 background:#e31e24;
 color:#fff;
 border:none;
 border-radius:10px;
 cursor:pointer;
}

.save-btn.cancel{
 background:#6b7280;
}

/* NEWS GRID */
#newsList{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
 gap:20px;
}

.news-card{
 background:#fff;
 border-radius:14px;
 overflow:hidden;
 box-shadow:0 5px 15px rgba(0,0,0,.1);
}

.news-body{padding:14px;}

.img-wrap{
 display:flex;
 gap:6px;
 overflow-x:auto;
 padding:10px;
}

.img-wrap img{
 width:120px;
 height:80px;
 object-fit:cover;
 border-radius:6px;
}
</style>
</head>

<body>

<script>
if(!localStorage.getItem("token")){
 location.href="/admin/login.html";
}
</script>

<div class="sidebar">
 <h2>MediaBuzz365</h2>
 <button onclick="navigate('add')">‚ûï Add News</button>
 <button onclick="navigate('list')">üì∞ All News</button>
 <button onclick="logout()">üö™ Logout</button>
</div>

<div class="main">

<!-- ADD -->
<div class="card" id="add">
<h3>Add / Edit News</h3>

<input id="city" placeholder="City">

<select id="category">
<option value="">-- Select --</option>
<option value="breaking">Breaking</option>
<option value="national">National</option>
<option value="international">International</option>
<option value="politics">Politics</option>
<option value="crime">Crime</option>
<option value="lifestyle">Lifestyle</option>
<option value="technology">Technology</option>
<option value="sports">Sports</option>
<option value="cinema">Cinema</option>
<option value="business">Business</option>
</select>

<input id="title" placeholder="Title">
<textarea id="description" placeholder="Description"></textarea>

<!-- üî• MULTI IMAGE -->
<input type="file" id="image" accept="image/*" multiple>

<button class="save-btn" onclick="saveNews()" id="saveBtn">Save</button>
<button class="save-btn cancel" onclick="cancelEdit()" id="cancelBtn" style="display:none">Cancel</button>
</div>

<!-- LIST -->
<div class="card" id="list">
<h3>All News</h3>
<div id="newsList"></div>
</div>

</div>

<script>
const API = location.hostname.includes("localhost")
 ? "http://localhost:3000"
 : "https://mediabuzz365.in";

let allNews=[];
let editMode=false;
let editId=null;

/* NAV */
function navigate(id){
 document.getElementById(id).scrollIntoView({behavior:"smooth"});
}

/* LOGOUT */
function logout(){
 localStorage.removeItem("token");
 location.href="/admin/login.html";
}

/* LOAD */
function loadNews(){
 fetch(API+"/api/news")
 .then(r=>r.json())
 .then(d=>{
  allNews=d.reverse();
  render(allNews);
 });
}

/* RENDER */
function render(data){
 newsList.innerHTML="";
 if(!data.length){
  newsList.innerHTML="<p>No news</p>";
  return;
 }

 data.forEach(n=>{
  newsList.innerHTML+=`
   <div class="news-card">

    <div class="img-wrap">
     ${(n.images||[]).map(img=>`
      <img src="${API}${img}">
     `).join("")}
    </div>

    <div class="news-body">
     <h4>${n.title}</h4>
     <p>üìç ${n.city}</p>

     <button onclick='editNews(${JSON.stringify(n)})'>Edit</button>
     <button onclick="deleteNews('${n._id}')">Delete</button>
    </div>
   </div>
  `;
 });
}

/* SAVE */
function saveNews(){

 if(!city.value || !category.value || !title.value){
  alert("Fill all");
  return;
 }

 const token=localStorage.getItem("token");
 const form=new FormData();

 form.append("city",city.value);
 form.append("category",category.value);
 form.append("title",title.value);
 form.append("description",description.value);

 /* MULTI FILE */
 for(let f of image.files){
  form.append("imageFiles",f);
 }

 let url=API+"/api/news";
 let method="POST";

 if(editMode){
  url+="/"+editId;
  method="PUT";
 }

 fetch(url,{
  method,
  headers:{
   "Authorization":"Bearer "+token
  },
  body:form
 })
 .then(r=>r.json())
 .then(()=>{
  alert("Saved");
  cancelEdit();
  loadNews();
 });
}

/* EDIT */
function editNews(n){
 editMode=true;
 editId=n._id;

 city.value=n.city;
 category.value=n.category;
 title.value=n.title;
 description.value=n.description;

 saveBtn.innerText="Update";
 cancelBtn.style.display="inline-block";
}

/* CANCEL */
function cancelEdit(){
 editMode=false;
 editId=null;

 city.value="";
 title.value="";
 description.value="";
 category.value="";
 image.value="";

 saveBtn.innerText="Save";
 cancelBtn.style.display="none";
}

/* DELETE */
function deleteNews(id){
 if(!confirm("Delete?")) return;

 const token=localStorage.getItem("token");

 fetch(API+"/api/news/"+id,{
  method:"DELETE",
  headers:{
   "Authorization":"Bearer "+token
  }
 })
 .then(()=>loadNews());
}

loadNews();
</script>

</body>
</html>
